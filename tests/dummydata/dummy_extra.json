{
  "pipeline": [
    {
      "source": "https://epistat.sciensano.be/data/COVID19BE_VACC_MUNI_CUM.csv",
      "model": "VaccinationsByNISCodeAndWeek",
      "metadata_handler": {
        "frequency": "daily",
        "date_column": "date"
      },
      "tranforms": [
        {
          "type": "drop_na"
        },
        {
          "type": "add_column",
          "data": {
            "column": "date",
            "column_from": "YEAR_WEEK",
            "update": {
              "type": "date",
              "suffix": "1",
              "format": "%yW%W%w"
            }
          }
        },
        {
          "type": "update_value",
          "data": {
            "column": "date",
            "update": {
              "type": "date",
              "subtract": {
                "days": 7
              }
            }
          }
        },
        {
          "type": "add_column",
          "data": {
            "column": "week",
            "column_from": "date",
            "update": {
              "type": "integer",
              "get": "weeknum"
            }
          }
        },
        {
          "type": "add_column",
          "data": {
            "column": "year",
            "column_from": "YEAR_WEEK",
            "update": {
              "type": "integer",
              "get": "year"
            }
          }
        },
        {
          "type": "drop_columns",
          "data": {
            "columns": [
              "YEAR_WEEK"
            ]
          }
        },
        {
          "type": "rename_columns",
          "data": {
            "columns": {
              "NIS5": "nis_code",
              "AGEGROUP": "agegroup",
              "DOSE": "dose",
              "CUMUL": "cumul_of_week"
            }
          }
        },
        {
          "type": "update_value",
          "data": {
            "column": "nis_code",
            "type": "string",
            "update": {
              "type": "string",
              "format": "{0:0>5}"
            }
          }
        },
        {
          "type": "update_value",
          "data": {
            "column": "nis_code",
            "update": {
              "type": "string",
              "find": "(\\.0+)",
              "replace": ""
            }
          }
        },
        {
          "type": "update_value",
          "data": {
            "column": "cumul_of_week",
            "type": "integer",
            "current_value": "<10",
            "value_if_true": {
                "type": "integer",
                "value": 10
            }
          }
        },
        {
          "type": "group_by",
          "data": {
            "columns": [
              "nis_code",
              "agegroup",
              "dose",
              "date",
              "week",
              "year"
            ],
            "aggregate": {
              "type": "sum"
            }
          }
        }
      ]
    }
  ]
}